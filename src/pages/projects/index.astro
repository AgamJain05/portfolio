---
import Pattern from "@/components/ui/pattern.astro";
import PageLayout from "@/layouts/page-layout.astro";

import Box from "@/components/box/index.astro";
import BoxHeader from "@/components/box/header.astro";
import BoxTitle from "@/components/box/title.astro";
import { getCollection } from "astro:content";
import ProjectItem from "@/components/sections/projects/project-item.astro";

const projects = await getCollection("projects");

const coreProjects = projects.filter(project => project.data.type === "core");
const mainProjects = projects.filter(project => project.data.type === "main");
const sideProjects = projects.filter(project => project.data.type === "side");

// Combine main and core projects (main projects first), then split for display
const builtToLastProjects = [...mainProjects, ...coreProjects];
const firstThreeProjects = builtToLastProjects.slice(0, 3);
const remainingProjects = builtToLastProjects.slice(3);
---

<PageLayout
  description="A collection of things I've built, full-stack apps, experiments, and side projects."
  title="My Projects"
>
  <Pattern />
  <Box>
    <BoxHeader>
      <BoxTitle>Built to Last </BoxTitle>
    </BoxHeader>

    {firstThreeProjects.map(item => <ProjectItem project={item} />)}
  </Box>

  {
    remainingProjects.length > 0 && (
      <>
        <Pattern />
        <Box>
          {remainingProjects.map(item => <ProjectItem project={item} />)}
        </Box>
      </>
    )
  }

  {
    sideProjects.length > 0 && (
      <>
        <Pattern />
        <Box>
          <BoxHeader>
            <BoxTitle>Side Hustles</BoxTitle>
          </BoxHeader>
          {sideProjects.map(item => <ProjectItem project={item} />)}
        </Box>
      </>
    )
  }
 
  <Pattern />
</PageLayout>
